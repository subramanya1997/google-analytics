# Email Workflow Summary

## Overview

The email workflow uses the HTML reports generated by `generate_branch_wise_report.py` and sends them directly as the email body to sales representatives.

## How It Works

1. **Report Generation**: The `generate_branch_wise_report.py` script creates individual HTML files for each branch in the `branch_reports/` folder
   - Example: `D01_report_20250629.html`, `D02_report_20250629.html`, etc.
   - Each HTML file contains inline CSS and is fully self-contained
   - Reports are minified and optimized for email delivery

2. **Email Sending**: The `send_branch_reports.py` script reads these HTML files and sends them as email bodies
   - The entire HTML report becomes the email content
   - No attachments needed - the email IS the report
   - Professional formatting is preserved across all email clients

## Quick Commands

### Test Email Configuration
```bash
# Dry run - see what would be sent
python scripts/send_branch_reports.py --dry-run

# Test sending to a specific branch
python scripts/test_send_report.py D01
```

### Send All Reports
```bash
# Send all branch reports
make send_reports

# Or directly
python scripts/send_branch_reports.py
```

### Full Automated Workflow
```bash
# SFTP sync + data load + report generation + email sending
make full_sync_with_email
```

## Configuration

### SMTP Settings (`configs/smtp_config.json`)
```json
{
    "server": "smtp.gmail.com",
    "port": 587,
    "use_tls": true,
    "username": "your-email@gmail.com",
    "password": "your-app-password",
    "from_address": "Sales Analytics <analytics@company.com>"
}
```

### Branch Email Mapping (`configs/branch_email_mapping.json`)
```json
{
    "D01": {
        "branch_name": "Downtown Branch",
        "email": "sales.rep@company.com",
        "name": "John Doe",
        "cc": "manager@company.com",
        "enabled": true
    }
}
```

## Email Format

The emails sent contain:
- **Subject**: "Daily Sales Report - [Branch Name] - [Date]"
- **Body**: The complete HTML report with:
  - Summary table of metrics
  - Purchase follow-up tasks with customer details
  - Cart abandonment recovery opportunities
  - Failed search terms
  - Repeat visitors without purchases
  - All professionally formatted with inline CSS

## Advantages

1. **No Attachments**: Reports are embedded in the email body for immediate viewing
2. **Mobile Friendly**: HTML is optimized for all devices
3. **Professional Look**: Consistent formatting with company branding
4. **Easy to Forward**: Recipients can easily forward the entire report
5. **No Download Required**: Sales reps can view reports directly in their email client

## Troubleshooting

If emails are not rendering properly:
1. Check that the HTML reports exist in `branch_reports/`
2. Verify SMTP credentials are correct
3. For Gmail, ensure you're using an app-specific password
4. Check spam/junk folders if emails aren't received
5. Review logs for any SMTP connection errors 